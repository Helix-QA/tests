Вот **понятное и структурированное описание того, что происходит в авто-тесте**. Его можно использовать как описание сценария, комментарий к фиче или пояснение в отчёте.

---

## Описание авто-теста «Чек коррекции»

Авто-тест проверяет полный бизнес-сценарий **создания и обработки чеков коррекции** в системе — как для **прихода денежных средств**, так и для **возврата (списания)**. Тест охватывает весь путь от оформления продажи до формирования фискальных данных и проверки ограничений на повторную корректировку.

---

### 1. Подготовка тестовых данных

В начале теста:

* запускается или используется существующий `TestClient`;
* очищаются все ранее созданные переменные;
* создаётся тестовый клиент;
* создаётся номенклатура «Групповая услуга»;
* инициализируются служебные переменные (даты, ссылки, реквизиты).

---

### 2. Сценарий ЧекКоррекции_1 — **Поступление денежных средств**

#### 2.1 Создание и оплата продажи

* Открывается форма создания документа **Реализация**.
* Заполняется контрагент и добавляется услуга в табличную часть.
* Документ сохраняется, ссылка на него запоминается.
* Выполняется оплата наличными средствами.
* Проверяется корректное закрытие смены.

---

#### 2.2 Переход к созданию чека коррекции

* По сохранённой ссылке открывается документ оплаты.
* Через субъект оплаты запускается обработка **«Создание чеков коррекции»**.

---

#### 2.3 Проверка формы «Создание чека коррекции»

Проверяется, что:

* автоматически заполнены автор, даты, касса, организация, контрагент;
* корректно сформированы табличные части **Позиции чека**, **Оплата**, **Основания**;
* суммы, НДС, признаки расчёта и налогообложения соответствуют исходной продаже;
* значения полей доступны/недоступны согласно логике формы;
* сохраняется дополнительный реквизит для дальнейших проверок.

---

#### 2.4 Проверка вкладок и элементов управления

* Проверяется переключение между вкладками: *Главное*, *Товары*, *Оплата*, *Комментарий*.
* Проверяется работа выпадающих списков, флагов, гиперссылок.
* Проверяется реакция формы на изменение системы налогообложения.
* Проверяется ввод и выбор значений вручную.

---

#### 2.5 Проверка работы табличных частей

* Добавление, удаление и перемещение строк в таблице позиций.
* Работа поиска и очистки в таблице оплат.
* Проверка доступности редактирования реквизитов.

---

#### 2.6 Создание чеков коррекции

* Нажатием кнопки **«Создать чеки»** формируются:

  * чек коррекции;
  * сторнирующий чек.
* Проверяется корректное закрытие смены.

---

#### 2.7 Проверка XML (исходные данные чека)

Проверяется, что:

* XML сформирован корректно;
* заполнены параметры кассира, типа операции, налогообложения;
* передан дополнительный реквизит;
* корректно описаны позиции, суммы и типы оплат;
* данные соответствуют требованиям фискального формата.

---

#### 2.8 Проверка созданных документов

* Проверяется наличие чека коррекции и чека сторно.
* Проверяется их статус (успешно пробиты).
* Проверяется переход по ссылкам и невозможность редактирования пробитого документа.

---

#### 2.9 Проверка защиты от повторной корректировки

* При повторной попытке создать чек коррекции:

  * отображается сообщение о том, что корректировка уже была создана;
  * повторное создание запрещено как из формы документа, так и из списка.

---

### 3. Сценарий ЧекКоррекции_2 — **Возврат (списание денежных средств)**

#### 3.1 Создание возврата

* По ранее созданной оплате оформляется возврат.
* Выполняется возврат наличных средств.
* Закрываются все окна клиента.

---

#### 3.2 Создание чека коррекции по возврату

* Повторно открывается форма создания чека коррекции.
* Проверяется корректность заполнения:

  * типа расчёта — *Возврат денежных средств*;
  * документа основания;
  * сумм, позиций, оплат;
  * реквизитов и налогообложения.
* Сохраняется новый дополнительный реквизит.

---

#### 3.3 Проверка XML для возврата

* Проверяется корректность XML-структуры для возвратного чека коррекции.
* Проверяется соответствие данных возврату, а не приходу.
* Проверяется отображение данных в форме «Исходные данные чека».

---

## Итог

Авто-тест полностью покрывает:

* создание продажи и возврата;
* формирование чеков коррекции;
* проверку UI, бизнес-логики и фискальных данных;
* защиту от повторного создания корректировок.

Тест гарантирует, что механизм **чеков коррекции работает корректно, стабильно и соответствует требованиям ККТ и фискального формата**.

Если хочешь — могу сделать **короткое описание (2–3 абзаца)** или вариант **для тест-кейса / TestIT / Allure**.
