# Маркетинговые акции

Проверка работы маркетинговых акций

## Описание работы автотеста Маркетинговых акции

Для автотестирования были реализованы два фича файла: `ExportMarketing(Экспортный фича файл)` и `MarketingPromotions(Основной фича файл для автотеста)`.

### Описание сценариев фича файла `MarketingPromotions`

- **Сценарий**: Создание МА с условием - Всегда, получатель - Ограничено списком клиентов.
В начале сценария идет создание МА с помощью экспорта, создается клиент и создается в общем кол-ве 4 МА с условием приминения "Всегда" и с типом получателя "Ограничено списком клиентов", но с разными способами применения: "Суммой", "Процентом", "Суммой на документ", "Подарком".

- **Сценарий**: Проверка на выполнение.
Потом идет стандартная проверка прошли ли корректно создание объектов тестирования, если нет, то идет закрытие всех клиентских окон, удаляются уже созданные объекты в справочнике МА и останавливается выполнение фича файла.

- **Сценарий**: Создание продажи и проверка условия - Всегда.
Реализована проверка с помощью одного экспортного сценария "Я создаю документ Продажи для МА с условием - Всегда.". Работает он следующим образом: Создается продажа, в ней указывается клиент1 и номенклатура для продажи, которые создаются через экспортный сценарий пункта 1, после выбора клиента и номенклатуры активируются МА и проверяются заголовки которые появились на форе(кол-во применившихся МА и Подарков) и проверяется табличная часть на изменения Сумм и скидок.
После проверки первой реализации, создается реализация на второго клиента который не относится к списку получателей скидов. Также как и первый раз создается продажа и проверяется форма на наличие скидок, если их нет, то всё отлично.

- **Сценарий**: Проверка условия - Всегда, получатель - Ограничено сегментом клиентов.
Идет создание почвы для проверки ограничения МА по получателям указанных в сегменте "Ограничено сегментом клиентов.". Создается сегмент клиентов, куда добавляется Клиент1, потом заходится в список маркетинговых акций, и заходя в уже ранее созданные меняется тип получателя с Ограничено списком клиентов на Ограничено сегментом клиентов.
Затем выполняется эскпортный сценарий из пункта 3, который работает точно также без каких-либо изменений.

- **Сценарий**: Проверка условия - Всегда, получатель - Ограничено видами дисконтных карт.
Создается сначала новый вид карт, потом заходится в общий список МА и в уже созданных маркетинговых акциях меняется тип получателя с Ограничено сегментом клиентов на Ограничено видами дисконтных карт и указывается внутри МА соответствующий вид карты. После этого в карточку `Клиента1` добавляется карта с соответствующий видом.
Потом происходит проверка через экспорт как в пункте 3.

- **Сценарий**: Проверка условия - Всегда, получатель - Клиент - рекламный источник.
Открывается карточка `Клиента2`, в ней как рекламный источник указывает член клуба - `Клиент1`. Создается продажа для `клиента2` чтобы условия отработали и происходит проверка документа продажи на МА. Условия должны быть, т.к в экспортном сценарии пункта 1, есть шаги создания МА с типом получателя "Клиент - рекламный источник".

- **Сценарий**: Проверка ограничения по клиенту в МА.
Из списка МА заходится в одну из них и внутри нее настраивается ограничение по кол-ву применений МА по клиенту. Через раздел МА "Доступна в структурных единицах" и там уже выставляются соответствующие условия. Затем создается продажа на Клиента1 и проверяется форма продажи на скидки.

- **Сценарий**: Создание МА Условия применения: День рождения.
Закрываю все окна клиентского приложения, затем удаляются созданные МА без контроля ссылок, после создаются МА аналогично первому сценарию, но только с условием применения "День рождения".

- **Сценарий**: Проверка на выполнение.
Как и в пункте 2, проверяет сценарий на корректно созданные данные, если есть ошибки.

- **Сценарий**: Создание продажи и проверка условия - День рождения.
Идет создание продажи и проверка начисления скидок на двух клиентов1 и 2, когда создавались эти два клиента, то при создании им были указаны соответствующие даты рождения чтобы у одного МА отрабатывали, а другого нет.

- **Сценарий**: Создание МА Условия применения: Количество.
Закрываются все окна и удаляются все данные из справочника МА. Создается с помощью экспорта две маркетинговые акции с условием применения "Количество в документе продажи" Не более/Не менее. И создается продажа куда должны попасть две МА.
Затем идет смена условия с "В документе продажи" на "По клиенту" в двух МА, а потом создается продажа, где также должны примениться две МА.
Затем идет проверка "Продаж по карте" Не более/Не менее и создается продажа с проверкой формой продажи.

- **Сценарий**: Создание МА Условия применения: Наличие членства (пакета услуг).
С помощью экспортного сценария создаются три МА с условием применения "Наличие членства (пакета услуг) или дней после окончания срока/и дней после активации/у родственника."
Сначала создается продажа для проверки условия "Наличие членства (пакета услуг) или дней после окончания срока", создается продажа и проверяется на наличие МА.
Потом заходится в членство `Клиента1` и меняется дата активация на задние число и проверяется вторая МА.
Для проверки третьего условия открываются две карточки клиентов `Клиент1` и `Клиент2`, в них выставляется принадлежность к полу. Потом в карточке Клиента1 указывается как родственник `Клиент2`. После того как родственник был указан создается продажа для Клиента2 и проверяется на применение МА с третьим условием.

- **Сценарий**: Создание МА Условия применения: Каждая.
Создаются две МА Условия применения: Каждая:
Третья покупка по клиенту за день;
Вторая покупка по карте за весь период;
И создается одна продажа по Клиенту1, т.к за все продажи которые были выше в сценариях он попадает под условия выполнения двух МА и в продаже соответственно должны примениться 2.

- **Сценарий**: Создание МА Условия применения: Остаток на лицевом счете.
Создаются две МА с ограничением остатка на лицевом счете, первая не менее `2000`, а вторая не более `4000`.
После создания открывается рецепция и через нее делается взнос на лицевой счет `Клиенту1` на сумму `2500`, чтобы попасть в рамки условий двух МА. Потом создается продажа и проверяется.
После проверки `Клиента 1`, делается взнос `Клиенту 2` через рецепцию, после заходится в список МА и открывается вторая МА с условием не более `4000` и устанавливается флаг "Не суммировать лицевые счета родственников" и затем создается продажа, где также должны отработать две МА.

- **Сценарий**: Создание МА Условия применения: Промокод.
Создается МА с условием применения "Промокод", создается также отдельный промокод для проверки(не реферальный). После создаетс продажа в которой указываются созданный промокод и проверяется продажа на МА.

- **Сценарий**: Создание МА Условия применения: Сумма в документе продажи.
Создается МА Условия применения: Сумма
В документе продажи - Не менее/ Не более
Создается продажа и проверяется.

- **Сценарий**: Создание МА Условия применения: Сумма продаж по клиенту/карте.
Условия применения: Сумма
Продаж по клиенту [не менее]/ по карте [не более] ;
Создается продажа и уже проверяется как отрабатают МА.

- **Сценарий**: Создание МА Условия применения: Тип продления членства (пакета услуг).
Сначала создается МА с условием применения Тип продления членства (пакета услуг) по условнию оно должно быть сначала Новое. Создается для этого третий клиент, продается членство, и в момент продажи должна отработать МА по условию "Новое", после проверки производится смена условия с "Новое" на "Продление". После установки условия включается выполнение регламента "ПересчетИтоговЧленствПакетовУслугПоСтекуИзменений". После этого открывается карточка Клиента3 и через командный интерфейс открывается раздел Членства и там продается второе членство для продления, на момент продажи МА должна отработать. Также происходит и смена с "Продление" на "Возобновление". В случае "Возобновления" продажа членства уже делается на Клиента1.

- **Сценарий**: Создание МА Условия применения: Подарок рефералу (промокод).
Создается МА с промокодом на подарок, при продаже указываем промокод и проверяем добавился ли подарок туда.

- **Сценарий**: Создание МА Условия применения: Бонусы по занятиям/по посещениям доп.владельцам.
Условия применения: По занятиям
Начислять дополнительным владельцам;
Условия применения: По посещениям
Начислять дополнительным владельцам;
Создаются две МА с условиями указанными выше, потом в членство Клиенту1 добавляется доп.владелец Клиент2. Затем создаетс1 персональное занятие для Клиента2, завершаю это занятие с отметкой что клиент прибыл. Потом захожу в список закрытия дня и перехожу ко вчерашнему закрытию дня и перепровожу его, чтобы в него записались два начисления на бонусный счет. В закрытие дня в разделе Бонусные счета проверяются эти начисления.

- **Сценарий**: Проверка Минимум,Максимум,Сложение,Умножение.
Сначала проверяются Максимум, создается отдельная группа с простыми двумя МА которые применяются Всегда. Создается продажа для проверки какая из МА подтянется и проверяется сумма из этой МА.
Потом происходит смена с Максимума на Минимум и проверяется точно также какая из МА подтянется в новой продаже.
После проверки Минимума меняем на Сложение и проверяем в продаже ее работу.
Потом проверяется Умножение. Для проверки умножения требуется чтобы скидка предоставлялась не Суммой, а Процентом, поэтому происходит смена условия применения с Суммы на Процент. Создается продажа для проверки и т.д.
После проверки умножения в настройке групп проверяется ограничения процента скидки на группу(`10%`), создается продажа с умножением, но в этот раз скидка будет не `19%`, а `10%` т.к ограничена группой
